"use strict";(self.webpackChunkadmin2=self.webpackChunkadmin2||[]).push([[765],{889:(D,p,i)=>{i.d(p,{s:()=>a});var h=i(262),u=i(608),c=i(7587),g=i(520);let a=(()=>{class n extends u.D{constructor(l){super(l),this.setRequestUrl("/admin/content_types")}getItemByName(l){const f=this.getRequestUrl()+`/by_name/${l}`;return this.http.get(f).pipe((0,h.K)(this.handleError()))}getItemByCategory(l){const f=this.getRequestUrl()+`/by_category/${l}`;return this.http.get(f).pipe((0,h.K)(this.handleError()))}}return n.\u0275fac=function(l){return new(l||n)(c.LFG(g.eN))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},5759:(D,p,i)=>{i.d(p,{P:()=>E});var h=i(3075),u=i(7579),c=i(2722),g=i(2061),a=i(7587),n=i(5330),_=i(2732),l=i(608);const f=["formEl"];let E=(()=>{class m{constructor(e,t,s,r){this.ref=e,this.config=t,this.systemNameService=s,this.dataService=r,this._formFieldsErrors={},this.loading=!1,this.files={},this.arrayFields={},this.arrayFieldsData={},this.destroyed$=new u.x,this.errorMessage="",this.closeReason="canceled",this.localeListFull=[],this.localeDefault="",this.localeCurrent="",this.localeFieldsAllowed=[],this.localePreviousValues={}}set formFieldsErrors(e){for(const t in e)if(e.hasOwnProperty(t)){const s=this.form.get(t);s&&s.setErrors({incorrect:!0})}this._formFieldsErrors=e}get formFieldsErrors(){return this._formFieldsErrors}ngOnInit(){this.config.data.id?this.getData(this.config.data.id,this.config.data.isClone||!1):setTimeout(()=>{this.updateControls(),this.form.controls.isActive&&this.form.controls.isActive.setValue(!0)},0),this.form.valueChanges.pipe((0,c.R)(this.destroyed$)).subscribe(()=>this.onValueChanged("form"))}onGetData(e,t=!1){this.model=e,t&&(this.model.id=0),this.updateControls()}onDataSaved(){this.closeReason="updated",this.loading=!1}onFilesSaved(e){}getData(e,t=!1){this.loading=!0,this.dataService.getItem(e).pipe((0,c.R)(this.destroyed$)).subscribe({next:s=>{this.onGetData(s,t),setTimeout(()=>{this.loading=!1},300)},error:s=>{s.error&&(this.errorMessage=s.error),this.loading=!1}})}getFormData(){const e=this.form.value;return this.model&&Object.keys(this.model).forEach(t=>{this.files[t]&&(e[t]=Array.isArray(this.model[t])?[g.O.getFileData(this.files[t])]:g.O.getFileData(this.files[t]))}),this.model.translations&&Object.keys(this.model.translations).length>0&&(e.translations=this.model.translations),Object.keys(e).forEach(t=>{if(t.indexOf("__")>-1){const s=t.split("__");if(!isNaN(s[1]))return;e[s[0]]||(e[s[0]]={}),e[s[0]][s[1]]=e[t],delete e[t]}}),this.model.id&&!e.id&&(e.id=this.model.id),e}saveRequest(){return this.model&&this.model.id?this.dataService.update(this.getFormData()):this.dataService.create(this.getFormData())}filesUploadRequest(e,t){return this.dataService.postFormData(e)}saveData(e=!1,t){if(t&&t.preventDefault(),this.errorMessage="",!this.form.valid)return this.formGroupMarkTouched(this.form),void this.focusFormError();this.onLocaleSwitch(this.localeDefault),this.loading=!0,this.saveRequest().pipe((0,c.R)(this.destroyed$)).subscribe({next:s=>{s.id&&(this.model=s),Object.keys(this.files).length>0?this.saveFiles(s._id||s.id,"",e):(this.onDataSaved(),e&&this.closeModal())},error:s=>{s.error&&(this.errorMessage=s.error),s.errors&&(this.formFieldsErrors=s.errors,this.focusFormError()),this.loading=!1}})}saveFiles(e,t="",s=!1){if(0===Object.keys(this.files).length)return void(s&&this.closeModal());const r=new FormData;for(const o in this.files)this.files.hasOwnProperty(o)&&this.files[o]instanceof File&&r.append(o,this.files[o],this.files[o].name);r.append("itemId",String(e)),r.append("ownerType","category"),this.filesUploadRequest(r,e).pipe((0,c.R)(this.destroyed$)).subscribe({next:o=>{this.files={},this.onDataSaved(),s?this.closeModal():this.onFilesSaved(o)},error:o=>{this.errorMessage=o.error,this.loading=!1}})}formGroupMarkTouched(e){Object.keys(e.controls).forEach(t=>{e.controls[t].markAsTouched(),e.controls[t].markAsDirty(),e.controls[t]instanceof h.Oe&&Array.from(this.form.controls[t].controls).forEach(s=>{this.formGroupMarkTouched(s)})})}updateControls(){const e=this.form.controls;let t="";Object.keys(this.arrayFieldsData).forEach(s=>{this.arrayFields[s].clear()}),Object.keys(e).forEach(s=>{var r;if(s.indexOf("__")>-1){const o=s.split("__");isNaN(o[1])?(this.model[o[0]]||(this.model[o[0]]={}),t=null!==(r=this.model[o[0]][o[1]])&&void 0!==r?r:""):t=this.model[s]||""}else t=this.model[s]||"";Array.isArray(t)&&this.arrayFields[s]?t.forEach((o,v)=>{this.arrayFieldAdd(s,o)}):e[s]instanceof h.Oe||e[s].setValue(t||"")})}createArrayFieldsProperty(e){Object.defineProperty(this.arrayFields,e,{get:()=>this.form?this.form.get(e):null})}buildFormGroup(e,t){if(!this.arrayFieldsData[e])return new h.cw({});const s={};for(let r in this.arrayFieldsData[e])!this.arrayFieldsData[e].hasOwnProperty(r)||(s[r]=new h.NI(t[r]||"",this.arrayFieldsData[e][r].validators));return new h.cw(s)}arrayFieldAdd(e,t,s){if(s&&s.preventDefault(),t||(t={}),!this.form.controls[e]||!this.arrayFields[e])return;const o=this.buildFormGroup(e,t);this.arrayFields[e].push(o)}arrayFieldDelete(e,t,s){s&&s.preventDefault(),this.arrayFields[e].removeAt(t)}arrayFieldUpdate(e,t){!this.form.controls[e]||!this.arrayFields[e]||(this.arrayFields[e].clear(),t.forEach((r,o)=>{this.arrayFieldAdd(e,r)}))}onLocaleSwitch(e){if((!this.model.translations||Array.isArray(this.model.translations))&&(this.model.translations={}),this.saveTranslations(),e===this.localeDefault)return this.localeFieldsAllowed.forEach(t=>{void 0!==this.localePreviousValues[t]&&(this.model[t]=this.localePreviousValues[t],this.form.controls[t].setValue(this.model[t]),delete this.localePreviousValues[t])}),void(this.localeCurrent=e);this.localeFieldsAllowed.forEach(t=>{this.localePreviousValues[t]=this.form.controls[t].value||"",this.model[t]=this.model.translations[t]&&this.model.translations[t][e]||"",this.form.controls[t].setValue(this.model[t])}),this.localeCurrent=e}saveTranslations(){this.localeCurrent!==this.localeDefault&&this.localeFieldsAllowed.forEach(e=>{this.form.controls[e].value?(this.model.translations[e]||(this.model.translations[e]={}),this.model.translations[e][this.localeCurrent]=this.form.controls[e].value):this.model.translations[e]&&(this.model.translations[e][this.localeCurrent]&&delete this.model.translations[e][this.localeCurrent],0===Object.keys(this.model.translations[e]).length&&delete this.model.translations[e])})}createLanguageSettings(e){this.localeListFull=this.getLanguagesList(e.systemSettings.SETTINGS_LANGUAGES),this.localeList=e.localeList,this.localeList.length>0&&(this.localeDefault=this.localeList[0],this.localeCurrent=this.localeList[0])}getLanguagesList(e){const t=[];return e.forEach(s=>{t.push({title:s.name,name:s.options.value})}),t}generateName(e,t){t&&t.preventDefault(),"root"!==(this.form.controls.name?this.form.controls.name.value:e.name||"")&&(e.name=this.systemNameService.generateName(this.form.controls.title?this.form.controls.title.value:e.title||""),this.form.controls.name&&this.form.controls.name.setValue(e.name))}focusFormError(){setTimeout(()=>{this.formEl.nativeElement.querySelector("input.ng-invalid, textarea.ng-invalid")&&this.formEl.nativeElement.querySelector("input.ng-invalid, textarea.ng-invalid").focus()},1)}onValueChanged(e){!this[e]||this[e].valid&&(this.formFieldsErrors={})}closeModal(e){e&&e.preventDefault(),this.ref.close(this.closeReason)}dismissModal(e){e&&e.preventDefault(),this.ref.close(null)}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}}return m.\u0275fac=function(e){return new(e||m)(a.Y36(n.E7),a.Y36(n.S),a.Y36(_.U),a.Y36(l.D))},m.\u0275cmp=a.Xpm({type:m,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&a.Gf(f,5),2&e){let s;a.iGM(s=a.CRH())&&(t.formEl=s.first)}},decls:0,vars:0,template:function(e,t){},encapsulation:2}),m})()},6421:(D,p,i)=>{i.d(p,{p:()=>m});var h=i(7579),u=i(2722),c=i(5698),g=i(511),a=i(7587),n=i(5330),_=i(889),l=i(608),f=i(2925),E=i(9783);let m=(()=>{class d{constructor(t,s,r,o,v,y){this.dialogService=t,this.contentTypesService=s,this.dataService=r,this.translateService=o,this.messageService=v,this.confirmationService=y,this.loading=!1,this.items=[],this.itemsTotal=0,this.queryOptions=new g.J(1,12,"createdDate","desc"),this.destroyed$=new h.x}ngOnInit(){this.menuItems=[{label:this.getLangString("REFRESH"),icon:"pi pi-refresh",command:()=>{this.queryOptions.page=1,this.queryOptions.search_word="",this.getData()}},{label:this.getLangString("DELETE_SELECTED"),icon:"pi pi-times",command:()=>{this.deleteSelected()}}],this.contextMenuItems=[{label:this.getLangString("EDIT"),icon:"pi pi-fw pi-pencil",command:()=>this.openModal(this.itemSelected)},{label:this.getLangString("DELETE"),icon:"pi pi-fw pi-trash",command:()=>this.deleteItem(this.itemSelected)}]}getData(t){t&&t.rows&&this.pageChanged(t),t&&t.sortField&&this.onSortingChange(t),this.loading=!0,this.dataService.getListPage(this.queryOptions).pipe((0,u.R)(this.destroyed$)).subscribe({next:s=>{this.items=s.items,this.itemsTotal=s.total,this.loading=!1,this.itemsSelected=[]},error:s=>{s.error&&this.messageService.add({key:"message",severity:"error",detail:s.error}),this.items=[],this.itemsTotal=0,this.loading=!1}})}getItemData(t){return{id:t?t.id:0}}getModalTitle(t){return this.getLangString(t?"EDIT":"CREATE")}openModal(t,s,r="",o=!1){s&&s.preventDefault(),this.dialogService.open(this.getModalComponent(),{header:this.getModalTitle(t),autoZIndex:!1,width:"800px",style:{maxWidth:"100%"},data:Object.assign({},this.getItemData(t),{isClone:o})}).onClose.pipe((0,c.q)(1)).subscribe(y=>{y&&"updated"===y&&(this.messageService.add({key:"message",severity:"success",summary:this.getLangString("MESSAGE"),detail:this.getLangString("DATA_SAVED_SUCCESSFULLY")}),this.getData())}),r&&setTimeout(()=>{window.document.querySelector(".p-component-overlay")&&window.document.querySelector(".p-component-overlay").classList.add(r)},1)}onSortingChange(t){t&&t.sortField&&(this.queryOptions.sort_by=t.sortField,this.queryOptions.sort_dir=t.sortOrder>0?"asc":"desc")}pageChanged(t){t&&t.rows&&(this.queryOptions.page=t.first/t.rows+1)}onInputSearch(){clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{this.getData()},500)}deleteItem(t,s){s&&s.preventDefault(),this.confirmationService.confirm({message:this.getLangString("YOU_SURE_YOU_WANT_DELETE"),accept:()=>{this.loading=!0,this.dataService.deleteItem(t.id).pipe((0,u.R)(this.destroyed$)).subscribe({next:r=>{this.messageService.add({key:"message",severity:"success",detail:this.getLangString("DELETED_SUCCESSFULLY")}),1===this.items.length&&(this.queryOptions.page=1),this.getData()},error:this.onRequestError.bind(this)})}})}blockSelected(){if(!this.itemsSelected||0===this.itemsSelected.length)return void this.showAlert(this.getLangString("NOTHING_IS_SELECTED"));const t=this.itemsSelected.map(s=>s.id);this.dataService.actionBatch(t,"block").pipe((0,u.R)(this.destroyed$)).subscribe({next:s=>{this.getData()},error:this.onRequestError.bind(this)})}deleteSelected(){this.itemsSelected&&0!==this.itemsSelected.length?this.confirmationService.confirm({message:this.getLangString("YOU_SURE_YOU_WANT_DELETE_SELECTED"),accept:()=>{const t=this.itemsSelected.map(s=>s.id);this.dataService.actionBatch(t,"delete").pipe((0,u.R)(this.destroyed$)).subscribe({next:s=>{this.messageService.add({key:"message",severity:"success",detail:this.getLangString("DELETED_SUCCESSFULLY")}),1===this.items.length&&(this.queryOptions.page=1),this.getData()},error:this.onRequestError.bind(this)})}}):this.showAlert(this.getLangString("NOTHING_IS_SELECTED"))}showAlert(t,s="error"){this.messageService.add({key:"message",severity:s,detail:t})}navBarToggle(){window.document.querySelector(".layout-sidebar").classList.toggle("active"),window.document.querySelector(".layout-mask").classList.toggle("layout-mask-active")}onOptionUpdate(t){const[s,r,o]=t}getLangString(t){return this.translateService.store.translations[this.translateService.currentLang]&&this.translateService.store.translations[this.translateService.currentLang][t]||t}onRequestError(t){t.error&&this.messageService.add({key:"message",severity:"error",detail:t.error}),this.loading=!1}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}}return d.\u0275fac=function(t){return new(t||d)(a.Y36(n.xA),a.Y36(_.s),a.Y36(l.D),a.Y36(f.sK),a.Y36(E.ez),a.Y36(E.YP))},d.\u0275cmp=a.Xpm({type:d,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,s){},encapsulation:2}),d})()},511:(D,p,i)=>{i.d(p,{J:()=>h});class h{constructor(c,g,a,n,_,l,f,E,m,d){this.page=c,this.limit=g,this.sort_by=a,this.sort_dir=n,this.order_by=_,this.full=l,this.only_active=f,this.query=E,this.search_word=m,this.category=d,void 0===m&&(this.search_word="")}}}}]);