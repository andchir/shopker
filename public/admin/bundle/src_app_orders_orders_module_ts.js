"use strict";(self.webpackChunkshk_app=self.webpackChunkshk_app||[]).push([["src_app_orders_orders_module_ts"],{3240:(R,M,c)=>{c.d(M,{B:()=>_});var T=c(9133),E=c(3405),f=c(8805),p=c(1599),C=c(103),h=c(3668),A=c(7283),v=c(8319);const q=["formEl"];let _=(()=>{class t{constructor(n,s,r,m,u,b){this.fb=n,this.activeModal=s,this.translateService=r,this.systemNameService=m,this.dataService=u,this.elRef=b,this.modalId="",this._formFieldsErrors={},this.submitted=!1,this.loading=!1,this.dataLoaded=!1,this.closeReason="canceled",this.files={},this.formFields=[],this.arrayFields={},this.isSaveButtonDisabled=!1,this.localeDefault="",this.localeCurrent="",this.localeFieldsAllowed=[],this.localePreviousValues={},this.uniqueId="",this.destroyed$=new E.xQ}set formErrors(n){for(const s in n)if(n.hasOwnProperty(s)){const r=this.getControl(this.form,null,s);r&&r.setErrors({incorrect:!0})}this._formFieldsErrors=n}get formErrors(){return this._formFieldsErrors}ngOnInit(){this.uniqueId=this.createUniqueId(),this.elRef&&this.getRootElement().setAttribute("id",this.modalId),this.onBeforeInit(),this.buildForm(),this.isEditMode||this.isItemCopy?this.getModelData().then(()=>{this.onAfterGetData()}):this.onAfterGetData(),this.onAfterInit()}onBeforeInit(){}onAfterInit(){}onAfterGetData(){this.dataLoaded=!0,this.buildControls(this.form,this.formFields)}getSystemFieldName(){return""}getLangString(n){return this.translateService.store.translations[this.translateService.currentLang][n]||n}getModelData(){return this.loading=!0,new Promise((n,s)=>{this.dataService.getItem(this.itemId).pipe((0,f.R)(this.destroyed$)).subscribe({next:r=>{if(this.isItemCopy){r.id=null;const m=this.getSystemFieldName();m&&(r[m]="")}Object.assign(this.model,r),this.loading=!1,n(r)},error:r=>{this.errorMessage=r.error||this.getLangString("ERROR"),this.loading=!1,s(r)}})})}buildForm(n="form",s=null,r=null,m="model"){s||(s=this.formFields),this[n]=this.fb.group(this.buildControls(null,s,m)),this[n].valueChanges.pipe((0,f.R)(this.destroyed$)).subscribe(()=>this.onValueChanged(n,r))}buildControls(n=null,s=[],r="model"){const m={};return s.forEach(u=>{const b=n?this.getControl(n,u):null;let g=null;if(r&&this[r]?(this[r].options||(this[r].options={}),g=0===u.name.indexOf("options_")?this[r].options[u.name.substr(8)]||null:this[r][u.name]||null):g=null,b)if(u.disabled&&b.disable(),u.children){const y=g,I=b;I.clear(),y.forEach((k,Y)=>{const D=this.getFormFieldByName(u.name),N=this.buildControls(null,D.children,null);I.push(this.fb.group(N))}),I.patchValue(y)}else b.setValue(g);else u.children?(m[u.name]=this.fb.array([]),this.createArrayFieldsProperty(u.name)):m[u.name]=this.fb.control({value:g,disabled:u.disabled||!1},u.validators)}),m}onValueChanged(n="form",s=null){this[n]&&(s||(s=this.formErrors),this[n].valid&&(this.errorMessage=""),Object.keys(this[n].value).forEach(m=>{s[m]="";const u=this.getControl(this[n],null,m);if(u&&!u.valid&&u.errors){let b="";Object.keys(u.errors).forEach(g=>{b+=(b?" ":"")+this.getLangString("INVALID_"+g.toUpperCase())}),s[m]=b}}))}getFormFieldByName(n){const s=this.formFields.filter(r=>r.name===n);return s.length>0?s[0]:null}createArrayFieldsProperty(n){Object.defineProperty(this.arrayFields,n,{get:()=>this.form?this.form.get(n):null})}getControl(n,s,r){return n?n.get(r||s.name):null}focusFormError(){setTimeout(()=>{this.formEl.nativeElement.querySelector(".form-control.is-invalid")&&this.formEl.nativeElement.querySelector(".form-control.is-invalid").focus()},1)}formGroupMarkTouched(n){Object.keys(n.controls).forEach(s=>{n.controls[s].markAsTouched(),n.controls[s]instanceof T.Oe&&Array.from(this.form.controls[s].controls).forEach(r=>{this.formGroupMarkTouched(r)})})}getSaveRequest(n){return n.id||"root"===n.name?this.dataService.update(n):this.dataService.create(n)}getFormData(){const n=this.form.value;return n.id=this.model.id||0,void 0!==this.model.translations&&(n.translations=this.model.translations||null),n}arrayFieldDelete(n,s,r){r&&r.preventDefault(),this.arrayFields[n].removeAt(s)}arrayFieldAdd(n,s){s&&s.preventDefault();const r=this.getFormFieldByName(n);if(!r)return;const m=this.buildControls(null,r.children,null);this.arrayFields[n].push(this.fb.group(m))}generateName(n,s,r=null){s&&s.preventDefault(),r||(r=this.form);const m=this.getControl(r,null,"title").value||"";n.name=this.systemNameService.generateName(m),this.getControl(r,null,"name").setValue(n.name)}closeModal(n){n&&n.preventDefault(),this.close(this.closeReason)}close(n,s){s&&s.preventDefault(),"submit"===n?this.activeModal.close(n):this.activeModal.dismiss(n)}minimize(n){n&&n.preventDefault(),window.document.body.classList.remove("modal-open");const s=this.getRootElement(),r=s.previousElementSibling;s.classList.remove("d-block"),s.classList.add("modal-minimized"),r.classList.add("d-none")}maximize(n){n&&n.preventDefault(),window.document.body.classList.add("modal-open");const s=this.getRootElement(),r=s.previousElementSibling;s.classList.add("d-block"),s.classList.remove("modal-minimized"),r.classList.remove("d-none")}save(n=!1,s){s&&s.preventDefault(),this.onSubmit(n)}saveFiles(n){if(0===Object.keys(this.files).length)return void this.close("submit");const s=new FormData;for(const r in this.files)this.files.hasOwnProperty(r)&&this.files[r]instanceof File&&s.append(r,this.files[r],this.files[r].name);s.append("itemId",String(n)),this.dataService.postFormData(s).pipe((0,f.R)(this.destroyed$)).subscribe({next:()=>{this.close("submit")},error:r=>{this.errorMessage=r.error||this.getLangString("ERROR"),this.submitted=!1,this.loading=!1}})}onSubmit(n=!1){if(this.formGroupMarkTouched(this.form),!this.form.valid)return this.errorMessage=this.getLangString("PLEASE_FIX_FORM_ERRORS"),void this.focusFormError();this.errorMessage="",this.loading=!0,this.submitted=!0;const s=this.getFormData();this.getSaveRequest(s).pipe((0,f.R)(this.destroyed$)).subscribe({next:r=>{Object.keys(this.files).length>0?this.saveFiles(r._id||r.id):n&&this.close("submit"),r&&r.id&&(this.model.id=r.id),this.closeReason="updated",this.loading=!1,this.submitted=!1},error:r=>{r.error&&(this.errorMessage=r.error),r.errors&&(this.formErrors=r.errors,this.errorMessage=this.getLangString("PLEASE_FIX_FORM_ERRORS")),this.loading=!1,this.submitted=!1}})}onLocaleSwitch(){if(this.localeCurrent===this.localeDefault)return this.localeFieldsAllowed.forEach(n=>{this.model[n]=this.localePreviousValues[n],this.getControl(this.form,null,n).setValue(this.localePreviousValues[n])}),void(this.isSaveButtonDisabled=!1);this.model.translations||(this.model.translations={}),this.isSaveButtonDisabled=!0,this.localeFieldsAllowed.forEach(n=>{this.localePreviousValues[n]=this.getControl(this.form,null,n).value,this.model.translations[n]?(this.model[n]=this.model.translations[n][this.localeCurrent]||"",this.getControl(this.form,null,n).setValue(this.model[n])):(this.model[n]="",this.getControl(this.form,null,n).setValue(""))})}saveTranslations(n){n&&n.preventDefault(),this.localeFieldsAllowed.forEach(s=>{this.getControl(this.form,null,s)&&this.getControl(this.form,null,s).value?(this.model.translations[s]||(this.model.translations[s]={}),this.model.translations[s][this.localeCurrent]=this.getControl(this.form,null,s).value):this.model.translations[s]&&(this.model.translations[s][this.localeCurrent]&&delete this.model.translations[s][this.localeCurrent],0===Object.keys(this.model.translations[s]).length&&delete this.model.translations[s])}),this.localeCurrent=this.localeDefault,this.onLocaleSwitch()}emailValidator(n){return n.value?/\S+@\S+\.\S+/.test(n.value)?void 0:{email:!0}:{required:!0}}getRootElement(){return this.elRef.nativeElement.parentNode.parentNode.parentNode}createUniqueId(){return Math.random().toString(36).substr(2,9)}displayToggle(n,s,r){r&&r.preventDefault(),n.style.display=(s=s||"none"===n.style.display)?"block":"none"}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(T.qu),h.Y36(A.Kz),h.Y36(v.sK),h.Y36(C.U),h.Y36(p.D),h.Y36(h.SBq))},t.\u0275cmp=h.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(n,s){if(1&n&&h.Gf(q,5),2&n){let r;h.iGM(r=h.CRH())&&(s.formEl=r.first)}},inputs:{modalTitle:"modalTitle",itemId:"itemId",modalId:"modalId",isItemCopy:"isItemCopy",isEditMode:"isEditMode"},decls:0,vars:0,template:function(n,s){},encapsulation:2}),t})()},5558:(R,M,c)=>{c.r(M),c.d(M,{OrdersModule:()=>_t});var T=c(6019),E=c(7367),f=c(8922),p=c(9133),C=c(3132),h=c(6721);class A{constructor(d,e,o,a,l,O,x,L,S,w,P,F,J){this.id=d,this.title=e,this.count=o,this.price=a,this.uniqId=l,this.priceTotal=O,this.contentTypeName=x,this.uri=L,this.image=S,this.parameters=w,this.files=P,this.currency=F,this.deleted=J,this.createParametersString(),this.createFilesString(),void 0===this.deleted&&(this.deleted=!1)}get parametersString(){return this._parametersString}set parametersString(d){this._parametersString=d}get filesString(){return this._filesString}set filesString(d){this._filesString=d}priceUpdate(){this.priceTotal=this.price*this.count;let d=0;void 0!==this.parameters&&this.parameters.forEach(e=>{d+=e.price*this.count}),this.priceTotal+=d}createParametersString(){if(!this.parameters)return;const d=[];this.parameters.forEach(e=>{let o="";e.name&&(o+=`${e.name}: `),o+=e.value+(e.price?` (${e.price})`:""),d.push(o)}),this.parametersString=d.join(", ")}createFilesString(){if(!this.files)return;const d=[],e=h.d.getBaseUrl();this.files.forEach(o=>{let l=`<a href="${e}admin/files/download/${o.fileId}" target="_blank">`;l+=`${o.title}.${o.extension}</a>`,d.push(l)}),this.filesString=d.join(", ")}}class v{constructor(d,e,o,a,l,O,x,L,S,w,P,F,J,ut,gt,ft,Zt,Tt,Ct,At){this.id=d,this.userId=e,this.status=o,this.email=a,this.phone=l,this.fullName=O,this.createdDate=x,this.deliveryName=L,this.deliveryPrice=S,this.paymentName=w,this.paymentValue=P,this.comment=F,this.contentCount=J,this.price=ut,this.currency=gt,this.options=ft,this.currencyRate=Zt,this.discount=Tt,this.discountPercent=Ct,this.promoCode=At}get content(){return this._content}set content(d){this._content=[],d.forEach(e=>{this._content.push(new A(e.id,e.title,e.count,e.price,e.uniqId,e.priceTotal,e.contentTypeName,e.uri,e.image,e.parameters,e.files||[],"",e.deleted||!1))})}}var q=c(5243),_=c(1599),t=c(3668),Z=c(4522);let n=(()=>{class i extends _.D{constructor(e){super(e),this.setRequestUrl("/admin/orders")}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(Z.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();var s=c(3240),r=c(1562),u=(c(843),c(417)),b=c(103),g=c(7283),y=c(8319),I=c(9518);function k(i,d){if(1&i&&(t.TgZ(0,"div",44),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.formErrors.email," ")}}function Y(i,d){if(1&i&&(t.TgZ(0,"div",44),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.formErrors.fullName," ")}}function D(i,d){if(1&i&&(t.TgZ(0,"div",44),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.formErrors.phone," ")}}function N(i,d){if(1&i&&(t.TgZ(0,"option",46),t._uU(1),t.qZA()),2&i){const e=d.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Oqu(e.name)}}function B(i,d){if(1&i&&(t.ynx(0),t.YNc(1,N,2,2,"option",45),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.settings.SETTINGS_DELIVERY)}}function j(i,d){if(1&i&&(t.TgZ(0,"option",46),t._uU(1),t.qZA()),2&i){const e=d.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Oqu(e.name)}}function K(i,d){if(1&i&&(t.ynx(0),t.YNc(1,j,2,2,"option",45),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.settings.SETTINGS_PAYMENT)}}const U=function(i){return{"is-invalid":i}};function $(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"tr",62),t.TgZ(1,"td"),t._UZ(2,"input",63),t.qZA(),t.TgZ(3,"td"),t._UZ(4,"input",64),t.qZA(),t.TgZ(5,"td",65),t._UZ(6,"input",66),t.qZA(),t.TgZ(7,"td",65),t.TgZ(8,"button",67),t.NdJ("click",function(a){const O=t.CHM(e).index;return t.oxw(4).arrayFieldDelete("options",O,a)}),t.ALo(9,"translate"),t._UZ(10,"i",11),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=d.$implicit;t.Q6J("formGroupName",d.index+""),t.xp6(2),t.Q6J("ngClass",t.VKq(7,U,e.controls.name.touched&&!e.controls.name.valid)),t.xp6(2),t.Q6J("ngClass",t.VKq(9,U,e.controls.title.touched&&!e.controls.title.valid)),t.xp6(2),t.Q6J("ngClass",t.VKq(11,U,e.controls.value.touched&&!e.controls.value.valid)),t.xp6(2),t.s9C("ngbTooltip",t.lcZ(9,5,"DELETE"))}}function V(i,d){if(1&i&&(t.TgZ(0,"tbody"),t.YNc(1,$,11,13,"tr",61),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",e.arrayFields.options.controls)}}function W(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",52),t.TgZ(1,"table",53),t.TgZ(2,"colgroup"),t._UZ(3,"col",54),t._UZ(4,"col",54),t._UZ(5,"col",55),t._UZ(6,"col",56),t.qZA(),t.TgZ(7,"thead"),t.TgZ(8,"tr"),t.TgZ(9,"th"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"th"),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"th"),t._uU(16),t.ALo(17,"translate"),t.qZA(),t._UZ(18,"th"),t.qZA(),t.qZA(),t.YNc(19,V,2,1,"tbody",34),t.TgZ(20,"tfoot"),t.TgZ(21,"tr",57),t.TgZ(22,"td",58),t.TgZ(23,"button",59),t.NdJ("click",function(a){return t.CHM(e),t.oxw(2).arrayFieldAdd("options",a)}),t._UZ(24,"i",60),t._uU(25," \xa0 "),t.TgZ(26,"span"),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(10),t.Oqu(t.lcZ(11,5,"SYSTEM_NAME")),t.xp6(3),t.Oqu(t.lcZ(14,7,"NAME")),t.xp6(3),t.Oqu(t.lcZ(17,9,"VALUE")),t.xp6(3),t.Q6J("ngIf",e.arrayFields.options),t.xp6(8),t.Oqu(t.lcZ(28,11,"ADD"))}}function H(i,d){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw(2).$implicit;t.xp6(1),t.hij(" ",e.title," ")}}function z(i,d){if(1&i&&(t.TgZ(0,"a",87),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).$implicit,o=t.oxw(3);t.hYB("href","",o.baseUrl,"",e.uri,"",t.LSH),t.xp6(1),t.hij(" ",e.title," ")}}function G(i,d){if(1&i&&(t.TgZ(0,"div"),t._UZ(1,"i",88),t._uU(2,"\xa0 "),t._UZ(3,"span",89),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(3),t.Q6J("innerHTML",e.filesString,t.oJD)}}function X(i,d){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr",78),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t.YNc(5,H,2,1,"ng-container",79),t.YNc(6,z,2,3,"ng-template",null,80,t.W1O),t.TgZ(8,"div",81),t._uU(9),t.YNc(10,G,4,1,"div",34),t.qZA(),t.qZA(),t.TgZ(11,"td",82),t._uU(12),t.ALo(13,"number"),t.qZA(),t.TgZ(14,"td",65),t._uU(15),t.qZA(),t.TgZ(16,"td",82),t.TgZ(17,"div",83),t.TgZ(18,"div",84),t.TgZ(19,"button",85),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit;return t.oxw(3).editContentToggle(a)}),t.ALo(20,"translate"),t._UZ(21,"i",86),t.qZA(),t.TgZ(22,"button",85),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit;return t.oxw(3).deleteContent(a)}),t.ALo(23,"translate"),t._UZ(24,"i",11),t.qZA(),t.qZA(),t.qZA(),t._uU(25),t.ALo(26,"number"),t.qZA(),t.qZA(),t.BQk()}if(2&i){const e=t.MAs(7),o=t.oxw().$implicit;t.xp6(1),t.Udp("text-decoration",o.deleted?"line-through":"none"),t.xp6(2),t.Oqu(o.id),t.xp6(2),t.Q6J("ngIf",!o.uri)("ngIfElse",e),t.xp6(4),t.hij(" ",o.parametersString," "),t.xp6(1),t.Q6J("ngIf",o.filesString),t.xp6(2),t.hij(" ",t.Dn7(13,12,o.price,"1.2-2","ru-RU")," "),t.xp6(3),t.hij(" ",o.count," "),t.xp6(4),t.s9C("ngbTooltip",t.lcZ(20,16,"EDIT")),t.xp6(3),t.s9C("ngbTooltip",t.lcZ(23,18,"DELETE")),t.xp6(3),t.hij(" ",t.Dn7(26,20,o.priceTotal,"1.2-2","ru-RU")," ")}}const Q=function(){return{standalone:!0}};function tt(i,d){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr",90),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td",82),t.TgZ(7,"input",91),t.NdJ("ngModelChange",function(a){return t.CHM(e),t.oxw().$implicit.price=a})("ngModelChange",function(){return t.CHM(e),t.oxw(4).priceTotalUpdate()}),t.qZA(),t.qZA(),t.TgZ(8,"td",92),t.TgZ(9,"input",93),t.NdJ("ngModelChange",function(a){return t.CHM(e),t.oxw().$implicit.count=a})("ngModelChange",function(){return t.CHM(e),t.oxw(4).priceTotalUpdate()}),t.qZA(),t.TgZ(10,"button",85),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit;return t.oxw(3).editContentToggle(a)}),t.ALo(11,"translate"),t._UZ(12,"i",94),t.qZA(),t.TgZ(13,"button",85),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).editContentCancel()}),t.ALo(14,"translate"),t._UZ(15,"i",95),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&i){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.id),t.xp6(2),t.hij(" ",e.title," "),t.xp6(2),t.Q6J("ngModel",e.price)("ngModelOptions",t.DdM(12,Q)),t.xp6(2),t.Q6J("ngModel",e.count)("ngModelOptions",t.DdM(13,Q)),t.xp6(1),t.s9C("ngbTooltip",t.lcZ(11,8,"ACCEPT")),t.xp6(3),t.s9C("ngbTooltip",t.lcZ(14,10,"CANCEL"))}}function et(i,d){if(1&i&&(t.ynx(0),t.YNc(1,X,27,24,"ng-container",34),t.YNc(2,tt,16,14,"ng-container",34),t.BQk()),2&i){const e=d.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!o.getIsContentEdit(e)),t.xp6(1),t.Q6J("ngIf",o.getIsContentEdit(e))}}function nt(i,d){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.Oqu(t.Dn7(2,1,e.model.discount,"1.2-2","ru-RU"))}}function ot(i,d){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.hij("",e.model.discountPercent,"%")}}function it(i,d){if(1&i&&(t.ynx(0),t.TgZ(1,"tr"),t._UZ(2,"td"),t.TgZ(3,"td",74),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"td",65),t.YNc(7,nt,3,5,"span",34),t.YNc(8,ot,2,1,"span",34),t.qZA(),t.qZA(),t.BQk()),2&i){const e=t.oxw(3);t.xp6(4),t.Oqu(t.lcZ(5,3,"DISCOUNT")),t.xp6(3),t.Q6J("ngIf",e.model.discount),t.xp6(1),t.Q6J("ngIf",e.model.discountPercent)}}function st(i,d){if(1&i&&(t.ynx(0),t.TgZ(1,"div",96),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.BQk()),2&i){const e=t.oxw(3);t.xp6(2),t.AsE(" ",t.lcZ(3,2,"PROMO_CODE"),": ",e.model.promoCode," ")}}function rt(i,d){if(1&i&&(t.TgZ(0,"table",53),t.TgZ(1,"colgroup"),t._UZ(2,"col",68),t._UZ(3,"col",69),t._UZ(4,"col",70),t._UZ(5,"col",71),t._UZ(6,"col",72),t.qZA(),t.TgZ(7,"thead"),t.TgZ(8,"tr"),t.TgZ(9,"th"),t._uU(10,"ID"),t.qZA(),t.TgZ(11,"th"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"th",65),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"th",65),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"th",65),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(23,"tbody"),t.YNc(24,et,3,2,"ng-container",73),t.YNc(25,it,9,5,"ng-container",34),t.TgZ(26,"tr"),t._UZ(27,"td"),t.TgZ(28,"td",74),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"td",65),t._uU(32),t.ALo(33,"number"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(34,"tfoot"),t.TgZ(35,"tr"),t.TgZ(36,"td",75),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.TgZ(39,"td",76),t.TgZ(40,"b"),t._uU(41),t.ALo(42,"number"),t.qZA(),t._uU(43," \xa0 "),t.TgZ(44,"span",77),t._uU(45),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(46,st,4,4,"ng-container",34)),2&i){const e=t.oxw(2);t.xp6(12),t.Oqu(t.lcZ(13,14,"NAME")),t.xp6(3),t.Oqu(t.lcZ(16,16,"PRICE")),t.xp6(3),t.Oqu(t.lcZ(19,18,"QUANTITY")),t.xp6(3),t.Oqu(t.lcZ(22,20,"PRICE_TOTAL")),t.xp6(3),t.Q6J("ngForOf",e.model.content),t.xp6(1),t.Q6J("ngIf",e.model.discount||e.model.discountPercent),t.xp6(4),t.Oqu(t.lcZ(30,22,"DELIVERY")),t.xp6(2),t.Udp("text-decoration",e.deliveryLimitApplied?"line-through":"none"),t.xp6(1),t.hij(" ",t.Dn7(33,24,e.model.deliveryPrice,"1.2-2","ru-RU")," "),t.xp6(5),t.hij(" ",t.lcZ(38,28,"PRICE_TOTAL"),": "),t.xp6(4),t.Oqu(t.Dn7(42,30,e.model.price,"1.2-2","ru-RU")),t.xp6(4),t.Oqu(e.model.currency),t.xp6(1),t.Q6J("ngIf",e.model.promoCode)}}function lt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",97),t._uU(1),t.TgZ(2,"button",98),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).errorMessage=""}),t.qZA(),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.errorMessage," ")}}function at(i,d){if(1&i&&(t.TgZ(0,"div"),t.TgZ(1,"ngb-accordion",47),t.TgZ(2,"ngb-panel",48),t.ALo(3,"translate"),t.YNc(4,W,29,13,"ng-template",49),t.qZA(),t.TgZ(5,"ngb-panel",50),t.ALo(6,"translate"),t.YNc(7,rt,47,34,"ng-template",49),t.qZA(),t.qZA(),t.YNc(8,lt,3,1,"div",51),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("closeOthers",!0),t.xp6(1),t.Q6J("title",t.lcZ(3,4,"OPTIONS")),t.xp6(3),t.Q6J("title",t.lcZ(6,6,"ORDER_CONTENT")),t.xp6(3),t.Q6J("ngIf",e.errorMessage)}}const dt=function(i){return{"no-events":i}},ct=function(i){return{"form-control-search-clear":i}};let mt=(()=>{class i extends s.B{constructor(e,o,a,l,O,x,L,S){super(e,o,a,l,O,x),this.fb=e,this.activeModal=o,this.translateService=a,this.systemNameService=l,this.dataService=O,this.elRef=x,this.settingsService=L,this.appSettings=S,this.model=new v(0,0,"","",""),this.modalTitle="Order",this.deliveryLimit=0,this.deliveryLimitApplied=!1,this.formFields=[{name:"id",validators:[p.kI.required]},{name:"email",validators:[p.kI.required,this.emailValidator]},{name:"phone",validators:[]},{name:"fullName",validators:[p.kI.required]},{name:"comment",validators:[]},{name:"deliveryName",validators:[]},{name:"paymentName",validators:[]},{name:"options",validators:[],children:[{name:"name",validators:[p.kI.required]},{name:"title",validators:[p.kI.required]},{name:"value",validators:[]}]},{name:"content",validators:[],children:[{name:"uniqId",validators:[]},{name:"id",validators:[]},{name:"price",validators:[]},{name:"count",validators:[]},{name:"deleted",validators:[]}]}],this.contentEdit=new A(0,"",0,0)}onAfterGetData(){this.getDeliveryLimit(),super.onAfterGetData()}onBeforeInit(){this.baseUrl=this.appSettings.settings.webApiUrl+"/",this.settings=this.appSettings.settings.systemSettings}getDeliveryLimit(){if(!this.model||!this.model.options)return;const e=this.model.options.findIndex(o=>"deliveryPriceLimit"===o.name);e>-1&&(this.deliveryLimit=parseFloat(this.model.options[e].value))}editContentToggle(e){if(this.getIsContentEdit(e)){const o=(0,C.findIndex)(this.model.content,{uniqId:this.contentEdit.uniqId,contentTypeName:this.contentEdit.contentTypeName});o>-1&&this.arrayFields.content.at(o).patchValue({price:this.model.content[o].price,count:this.model.content[o].count}),this.contentEdit=new A(0,"",0,0),this.priceTotalUpdate()}else this.contentEdit=(0,C.cloneDeep)(e)}editContentCancel(){if(!this.contentEdit.uniqId)return;const e=(0,C.findIndex)(this.model.content,{uniqId:this.contentEdit.uniqId,contentTypeName:this.contentEdit.contentTypeName});e>-1&&(this.model.content[e]=(0,C.cloneDeep)(this.contentEdit),this.contentEdit=new A(0,"",0,0,""),this.priceTotalUpdate())}getIsContentEdit(e){return this.contentEdit.uniqId===e.uniqId&&this.contentEdit.contentTypeName===e.contentTypeName}deleteContent(e){const o=(0,C.findIndex)(this.model.content,{uniqId:e.uniqId,contentTypeName:e.contentTypeName});o>-1&&(this.arrayFields.content.at(o).get("deleted").setValue(!this.model.content[o].deleted),this.model.content[o].deleted=!this.model.content[o].deleted,this.priceTotalUpdate())}onDeliveryUpdate(){if(!this.settings||!this.settings.SETTINGS_DELIVERY)return;const e=(0,C.findIndex)(this.settings.SETTINGS_DELIVERY,{name:this.model.deliveryName});if(e>-1){const o=parseFloat(String(this.settings.SETTINGS_DELIVERY[e].options.price));this.model.deliveryPrice=o/(this.model.currencyRate||1),this.priceTotalUpdate()}}priceTotalUpdate(){let e=0;this.model.content.forEach(o=>{o instanceof A&&o.priceUpdate(),!o.deleted&&(e+=o.priceTotal)}),this.model.discount&&(e-=this.model.discount),this.model.discountPercent&&(e*=this.model.discountPercent/100),this.deliveryLimit&&e>=this.deliveryLimit?this.deliveryLimitApplied=!0:(e+=this.model.deliveryPrice||0,this.deliveryLimitApplied=!1),this.model.price=Math.max(e,0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.qu),t.Y36(g.Kz),t.Y36(y.sK),t.Y36(b.U),t.Y36(n),t.Y36(t.SBq),t.Y36(r.g),t.Y36(h.d))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-modal-order"]],features:[t._Bn([]),t.qOj],decls:103,vars:83,consts:[[1,"position-relative","modal-on-maximized"],[1,"tabs-top"],["type","button",1,"btn","btn-outline-primary","btn-sm","d-block",3,"disabled","click"],[1,"icon-cross","me-1"],[1,"icon-minimize","me-1"],[1,"modal-header","d-block"],[1,"position-relative","modal-on-minimized"],[1,"pos-absolute-right"],["type","button",1,"btn","btn-no-border","btn-sm-sm",3,"title","click"],[1,"icon-maximize"],["type","button",1,"btn","btn-no-border","btn-sm-sm","ms-1",3,"title","click"],[1,"icon-cross"],[1,"modal-title","text-overflow","me-5"],["method","post",3,"formGroup","ngClass","ngSubmit"],["formEl",""],[1,"modal-body","py-0"],[1,"card","bg-light","mb-3"],[1,"card-body","p-2"],[1,"float-end"],["target","_blank",1,"btn","btn-info","btn-sm","btn-wide",3,"href"],[1,"icon-printer"],[1,"d-inline-block","p-1"],[1,"clearfix"],[1,"row"],[1,"col-lg-6"],[1,"mb-2","form-group-message"],[1,"label-filled"],["type","text","name","id","formControlName","id","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["type","text","name","title","formControlName","email",1,"form-control",3,"ngModel","ngClass","ngModelChange"],["class","alert alert-danger",4,"ngIf"],["type","text","name","title","formControlName","fullName",1,"form-control",3,"ngModel","ngClass","ngModelChange"],["type","text","name","phone","formControlName","phone",1,"form-control",3,"ngModel","ngModelChange"],["name","comment","formControlName","comment","rows","5",1,"form-control",3,"ngModel","ngModelChange"],["name","deliveryName","formControlName","deliveryName",1,"form-select",3,"ngModel","ngModelChange"],[4,"ngIf"],["name","paymentName","formControlName","paymentName",1,"form-select",3,"ngModel","ngModelChange"],[1,"modal-footer","d-block"],[1,"btn-group","me-1"],["type","button",1,"btn","btn-success","btn-wide",3,"disabled","click"],["ngbDropdown","","role","group","placement","top-right",1,"btn-group"],["type","button","ngbDropdownToggle","",1,"btn","btn-success","dropdown-toggle-split",3,"disabled"],["ngbDropdownMenu","",1,"dropdown-menu","dropdown-menu-end"],["type","button","ngbDropdownItem","",3,"click"],["type","button",1,"btn","btn-secondary","btn-wide",3,"click"],[1,"alert","alert-danger"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["activeIds","accordion-order-content",1,"ngb-accordion",3,"closeOthers"],["id","accordion-order-options",3,"title"],["ngbPanelContent",""],["id","accordion-order-content",3,"title"],["class","alert alert-dismissible alert-danger mt-3 mb-0",4,"ngIf"],["formArrayName","options"],[1,"table","table-bordered","mb-0"],["width","27%"],["width","39%"],["width","7%"],[1,"bg-faded"],["colspan","4",1,"text-center"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],[1,"icon-plus"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["type","text","formControlName","name",1,"form-control","form-control-sm",3,"ngClass"],["type","text","formControlName","title",1,"form-control","form-control-sm",3,"ngClass"],[1,"text-center"],["type","text","formControlName","value",1,"form-control","form-control-sm",3,"ngClass"],["type","button",1,"btn","btn-secondary","btn-sm",3,"ngbTooltip","click"],["width","10%"],["width","30%"],["width","20%"],["width","15%"],["width","25%"],[4,"ngFor","ngForOf"],["colspan","3"],["colspan","4",1,"text-end"],[1,"text-center","big"],[1,"small"],[1,"show-on-hover-parent"],[4,"ngIf","ngIfElse"],["productLink",""],[1,"text-muted","small"],[1,"text-center","pe-2"],[1,"relative"],[1,"show-on-hover-right","no-wrap"],["type","button",1,"btn","btn-secondary","btn-sm","ms-2",3,"ngbTooltip","click"],[1,"icon-pencil"],["target","_blank",3,"href"],[1,"icon-file"],[3,"innerHTML"],[1,"table-warning"],["type","number","name","price[]","min","0","step","0.01",1,"d-inline-block","form-control","form-control-sm",2,"width","100px",3,"ngModel","ngModelOptions","ngModelChange"],["colspan","2",1,"no-wrap"],["type","number","name","count[]","min","1","step","1",1,"d-inline-block","form-control","form-control-sm",2,"width","60px",3,"ngModel","ngModelOptions","ngModelChange"],[1,"icon-check"],[1,"icon-ban"],[1,"pt-3"],[1,"alert","alert-dismissible","alert-danger","mt-3","mb-0"],["type","button",1,"btn-close",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"button",2),t.NdJ("click",function(l){return o.closeModal(l)}),t._UZ(3,"i",3),t.TgZ(4,"span"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.qZA(),t.TgZ(7,"button",2),t.NdJ("click",function(l){return o.minimize(l)}),t._UZ(8,"i",4),t.TgZ(9,"span"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"div",5),t.TgZ(13,"div",6),t.TgZ(14,"div",7),t.TgZ(15,"button",8),t.NdJ("click",function(l){return o.maximize(l)}),t.ALo(16,"translate"),t._UZ(17,"i",9),t.qZA(),t.TgZ(18,"button",10),t.NdJ("click",function(l){return o.closeModal(l)}),t.ALo(19,"translate"),t._UZ(20,"i",11),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"h4",12),t._uU(22),t.qZA(),t.qZA(),t.TgZ(23,"form",13,14),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.TgZ(25,"div",15),t.TgZ(26,"div",16),t.TgZ(27,"div",17),t.TgZ(28,"div",18),t.TgZ(29,"a",19),t._UZ(30,"i",20),t._uU(31),t.ALo(32,"translate"),t.qZA(),t.qZA(),t.TgZ(33,"div",21),t._uU(34),t.ALo(35,"date"),t.qZA(),t._UZ(36,"div",22),t.qZA(),t.qZA(),t.TgZ(37,"div",23),t.TgZ(38,"div",24),t.TgZ(39,"div",25),t.TgZ(40,"label",26),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"input",27),t.NdJ("ngModelChange",function(l){return o.model.id=l}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(44,"div",24),t.TgZ(45,"div",25),t.TgZ(46,"label",26),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"input",28),t.NdJ("ngModelChange",function(l){return o.model.email=l}),t.qZA(),t.YNc(50,k,2,1,"div",29),t.qZA(),t.qZA(),t.qZA(),t.TgZ(51,"div",23),t.TgZ(52,"div",24),t.TgZ(53,"div",25),t.TgZ(54,"label",26),t._uU(55),t.ALo(56,"translate"),t.qZA(),t.TgZ(57,"input",30),t.NdJ("ngModelChange",function(l){return o.model.fullName=l}),t.qZA(),t.YNc(58,Y,2,1,"div",29),t.qZA(),t.TgZ(59,"div",25),t.TgZ(60,"label",26),t._uU(61),t.ALo(62,"translate"),t.qZA(),t.TgZ(63,"input",31),t.NdJ("ngModelChange",function(l){return o.model.phone=l}),t.qZA(),t.YNc(64,D,2,1,"div",29),t.qZA(),t.qZA(),t.TgZ(65,"div",24),t.TgZ(66,"div",25),t.TgZ(67,"label",26),t._uU(68),t.ALo(69,"translate"),t.qZA(),t.TgZ(70,"textarea",32),t.NdJ("ngModelChange",function(l){return o.model.comment=l}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(71,"div",23),t.TgZ(72,"div",24),t.TgZ(73,"div",25),t.TgZ(74,"label",26),t._uU(75),t.ALo(76,"translate"),t.qZA(),t.TgZ(77,"select",33),t.NdJ("ngModelChange",function(l){return o.model.deliveryName=l})("ngModelChange",function(){return o.onDeliveryUpdate()}),t.YNc(78,B,2,1,"ng-container",34),t.qZA(),t.qZA(),t.qZA(),t.TgZ(79,"div",24),t.TgZ(80,"div",25),t.TgZ(81,"label",26),t._uU(82),t.ALo(83,"translate"),t.qZA(),t.TgZ(84,"select",35),t.NdJ("ngModelChange",function(l){return o.model.paymentName=l}),t.YNc(85,K,2,1,"ng-container",34),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(86,at,9,8,"div",34),t.qZA(),t.TgZ(87,"div",36),t.TgZ(88,"div",37),t.TgZ(89,"button",38),t.NdJ("click",function(l){return o.save(!0,l)}),t.TgZ(90,"span"),t._uU(91),t.ALo(92,"translate"),t.qZA(),t.qZA(),t.TgZ(93,"div",39),t._UZ(94,"button",40),t.TgZ(95,"div",41),t.TgZ(96,"button",42),t.NdJ("click",function(l){return o.save(!1,l)}),t._uU(97),t.ALo(98,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(99,"button",43),t.NdJ("click",function(l){return o.closeModal(l)}),t.TgZ(100,"span"),t._uU(101),t.ALo(102,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("disabled",o.submitted),t.xp6(3),t.Oqu(t.lcZ(6,44,"CLOSE")),t.xp6(2),t.Q6J("disabled",o.submitted),t.xp6(3),t.Oqu(t.lcZ(11,46,"MINIMIZE")),t.xp6(5),t.Q6J("title",t.lcZ(16,48,"EXPAND")),t.xp6(3),t.Q6J("title",t.lcZ(19,50,"CLOSE")),t.xp6(4),t.Oqu(o.modalTitle),t.xp6(1),t.Q6J("formGroup",o.form)("ngClass",t.VKq(77,dt,o.submitted)),t.xp6(2),t.ekj("loading",o.loading),t.xp6(4),t.hYB("href","",o.baseUrl,"admin/orders/print/",o.model.id,"",t.LSH),t.xp6(2),t.hij(" ",t.lcZ(32,52,"PRINT")," "),t.xp6(3),t.hij(" ",t.xi3(35,54,o.model.createdDate,"dd/MM/y H:mm:s")," "),t.xp6(7),t.hij(" ",t.lcZ(42,57,"ID")," "),t.xp6(2),t.ekj("is-invalid",o.formErrors.id),t.Q6J("ngModel",o.model.id),t.xp6(4),t.hij(" ",t.lcZ(48,59,"EMAIL")," "),t.xp6(2),t.Q6J("ngModel",o.model.email)("ngClass",t.VKq(79,U,o.form.controls.email.touched&&!o.form.controls.email.valid)),t.xp6(1),t.Q6J("ngIf",o.formErrors.email),t.xp6(5),t.hij(" ",t.lcZ(56,61,"FULL_NAME")," "),t.xp6(2),t.Q6J("ngModel",o.model.fullName)("ngClass",t.VKq(81,U,o.form.controls.fullName.touched&&!o.form.controls.fullName.valid)),t.xp6(1),t.Q6J("ngIf",o.formErrors.fullName),t.xp6(3),t.hij(" ",t.lcZ(62,63,"PHONE")," "),t.xp6(2),t.Q6J("ngModel",o.model.phone),t.xp6(1),t.Q6J("ngIf",o.formErrors.phone),t.xp6(4),t.hij(" ",t.lcZ(69,65,"COMMENT")," "),t.xp6(2),t.Q6J("ngModel",o.model.comment),t.xp6(5),t.hij(" ",t.lcZ(76,67,"DELIVERY_METHOD")," "),t.xp6(2),t.Q6J("ngModel",o.model.deliveryName),t.xp6(1),t.Q6J("ngIf",o.settings),t.xp6(4),t.hij(" ",t.lcZ(83,69,"PAYMENT_METHOD")," "),t.xp6(2),t.Q6J("ngModel",o.model.paymentName),t.xp6(1),t.Q6J("ngIf",o.settings),t.xp6(1),t.Q6J("ngIf",o.model.content),t.xp6(3),t.Q6J("disabled",o.submitted),t.xp6(2),t.Oqu(t.lcZ(92,71,"SAVE_AND_CLOSE")),t.xp6(3),t.Q6J("disabled",o.submitted),t.xp6(3),t.Oqu(t.lcZ(98,73,"SAVE")),t.xp6(4),t.Oqu(t.lcZ(102,75,"CLOSE")))},directives:[p._Y,p.JL,p.sg,T.mk,p.Fj,p.JJ,p.u,T.O5,p.EJ,g.jt,g.iD,g.Vi,g.TH,T.sg,p.YN,p.Kr,g.gY,g.Gk,g.gW,p.CE,p.x0,g._L,p.qQ,p.wV,p.On],pipes:[y.X$,T.uU,T.JJ],encapsulation:2}),i})();const pt=[{path:"",component:(()=>{class i extends q.U{constructor(e,o,a,l){super(e,o,a,l),this.dataService=e,this.activeModal=o,this.modalService=a,this.translateService=l,this.queryOptions=new u.J("createdDate","desc",1,10,0,0),this.items=[],this.tableFields=[{name:"id",sortName:"id",title:"ID",outputType:"text",outputProperties:{}},{name:"status",sortName:"status",title:"STATUS",outputType:"status",outputProperties:{}},{name:"price",sortName:"price",title:"PRICE",outputType:"number",outputProperties:{}},{name:"contentCount",sortName:"contentCount",title:"CONTENT_COUNT",outputType:"text",outputProperties:{}},{name:"email",sortName:"email",title:"EMAIL",outputType:"userEmail",outputProperties:{}},{name:"createdDate",sortName:"createdDate",title:"DATE_TIME",outputType:"date",outputProperties:{format:"dd/MM/y H:mm:s"}}]}setModalInputs(e,o=!1,a=""){this.modalRef.componentInstance.modalTitle=`${this.getLangString("ORDER")} #${e}`,this.modalRef.componentInstance.modalId=a,this.modalRef.componentInstance.itemId=e||0,this.modalRef.componentInstance.isItemCopy=o||!1,this.modalRef.componentInstance.isEditMode=!0}getModalElementId(e){return["modal","order",e||0].join("-")}getModalContent(){return mt}changeRequest(e){const[o,a,l]=e;!o.id||this.dataService.updateProperty(o.id,a,l).subscribe(()=>{this.getList()})}}return i.title="ORDERS",i.\u0275fac=function(e){return new(e||i)(t.Y36(n),t.Y36(g.Kz),t.Y36(g.FF),t.Y36(y.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-shk-orders"]],features:[t._Bn([n]),t.qOj],decls:31,vars:26,consts:[[1,"card"],[1,"card-body"],[1,"icon-bag"],[1,"mb-3"],[1,"float-md-start"],[1,"form-control-search","mb-2","mb-md-0",3,"ngClass"],["type","text",1,"form-control","min-width250",3,"placeholder","ngModel","ngModelChange"],[3,"click"],[1,"float-md-end"],["ngbDropdown","","placement","bottom-right",1,"d-block","d-md-inline-block","mb-2","mb-md-0"],["ngbDropdownToggle","",1,"btn","btn-info","d-block","d-md-inline-block","width-100","width-md-auto"],["ngbDropdownMenu","",1,"dropdown-menu","dropdown-menu-end"],[1,"dropdown-item",3,"click"],["type","button",1,"btn","btn-secondary","d-block","d-md-inline-block","width-100","width-md-auto","ms-md-2",3,"ngbTooltip","click"],[1,"icon-reload"],[1,"float-start"],[1,"clearfix"],[1,"min-height400"],[3,"items","selectedIds","collectionSize","queryOptions","tableFields","loading","isCloneAllowed","selectedIdsChange","loadingChange","actionRequest","changeRequest"],["table",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h3"),t._UZ(3,"i",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"hr"),t.TgZ(7,"div",3),t.TgZ(8,"div",4),t.TgZ(9,"div",5),t.TgZ(10,"input",6),t.NdJ("ngModelChange",function(l){return o.queryOptions.search_word=l})("ngModelChange",function(){return o.onSearchWordUpdate()}),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"span",7),t.NdJ("click",function(){return o.onSearchWordUpdate("")}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(13,"div",8),t.TgZ(14,"div",9),t.TgZ(15,"button",10),t.TgZ(16,"span"),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.qZA(),t.TgZ(19,"div",11),t.TgZ(20,"button",12),t.NdJ("click",function(){return o.deleteSelected()}),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(23,"button",13),t.NdJ("click",function(){return o.getList()}),t.ALo(24,"translate"),t._UZ(25,"i",14),t.qZA(),t.qZA(),t._UZ(26,"div",15),t._UZ(27,"div",16),t.qZA(),t.TgZ(28,"div",17),t.TgZ(29,"app-table",18,19),t.NdJ("selectedIdsChange",function(l){return o.selectedIds=l})("loadingChange",function(l){return o.loading=l})("actionRequest",function(l){return o.actionRequest(l)})("changeRequest",function(l){return o.changeRequest(l)}),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.hij(" ",t.lcZ(5,14,"ORDERS")," "),t.xp6(5),t.Q6J("ngClass",t.VKq(24,ct,!!o.queryOptions.search_word)),t.xp6(1),t.MGl("placeholder","",t.lcZ(11,16,"SEARCH"),"..."),t.Q6J("ngModel",o.queryOptions.search_word),t.xp6(7),t.Oqu(t.lcZ(18,18,"BATCH_ACTIONS")),t.xp6(4),t.Oqu(t.lcZ(22,20,"DELETE")),t.xp6(2),t.s9C("ngbTooltip",t.lcZ(24,22,"REFRESH")),t.xp6(6),t.Q6J("items",o.items)("selectedIds",o.selectedIds)("collectionSize",o.collectionSize)("queryOptions",o.queryOptions)("tableFields",o.tableFields)("loading",o.loading)("isCloneAllowed",!1))},directives:[T.mk,p.Fj,p.JJ,p.On,g.jt,g.iD,g.Vi,g._L,I.a],pipes:[y.X$],encapsulation:2}),i})()}];let ht=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[f.Bz.forChild(pt)],f.Bz]}),i})(),_t=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[n],imports:[[T.ez,E.m,ht]]}),i})()},5243:(R,M,c)=>{c.d(M,{U:()=>_});var T=c(3405),E=c(8805),f=c(417),p=c(1599),C=c(9985),h=c(3668),A=c(7283),v=c(8319);const q=["table"];let _=(()=>{class t{constructor(n,s,r,m){this.dataService=n,this.activeModal=s,this.modalService=r,this.translateService=m,this.items=[],this.loading=!1,this.selectedIds=[],this.collectionSize=0,this.queryOptions=new f.J("name","asc",1,10,0,0),this.destroyed$=new T.xQ}ngOnInit(){this.getList(),this.afterInit()}afterInit(){}onSearchClear(){this.getList()}onModalClose(n){}onSearchWordUpdate(n){if(void 0!==n)return this.queryOptions.search_word=n,this.queryOptions.page=1,void(this.queryOptions.search_word?this.getList():this.onSearchClear());clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{this.queryOptions.page=1,this.getList()},700)}getModalElementId(n){return["modal",n||0].join("-")}setModalInputs(n,s=!1,r=""){const m=void 0!==n&&!s;this.modalRef.componentInstance.modalTitle=this.getLangString(m?"EDITING":"ADD"),this.modalRef.componentInstance.modalId=r,this.modalRef.componentInstance.itemId=n||0,this.modalRef.componentInstance.isItemCopy=s||!1,this.modalRef.componentInstance.isEditMode=m}modalOpen(n,s=!1){const r=this.getModalElementId(n);if(window.document.body.classList.add("modal-open"),window.document.getElementById(r)){const m=window.document.getElementById(r),u=m.previousElementSibling;return m.classList.add("d-block"),m.classList.remove("modal-minimized"),void u.classList.remove("d-none")}this.modalRef=this.modalService.open(this.getModalContent(),{size:"lg",backdrop:"static",keyboard:!1,backdropClass:"modal-backdrop-left45",windowClass:"modal-left45",container:"#modals-container"}),this.setModalInputs(n,s,r),this.modalRef.result.then(m=>{this.destroyed$.isStopped||(this.onModalClose(m),this.getList())},m=>{this.destroyed$.isStopped||(this.onModalClose(m),m&&["submit","updated"].indexOf(m)>-1&&this.getList())})}deleteItemConfirm(n){this.modalRef=this.modalService.open(C.q0),this.modalRef.componentInstance.modalTitle=this.getLangString("CONFIRM"),this.modalRef.componentInstance.modalContent=this.getLangString("YOU_SURE_YOU_WANT_DELETE"),this.modalRef.result.then(s=>{"accept"===s&&this.deleteItem(n)})}getLangString(n){return this.translateService.store.translations[this.translateService.currentLang]&&this.translateService.store.translations[this.translateService.currentLang][n]||n}confirmAction(n){return this.modalRef=this.modalService.open(C.q0),this.modalRef.componentInstance.modalTitle=this.getLangString("CONFIRM"),this.modalRef.componentInstance.modalContent=n,this.modalRef.result}blockSelected(){0!==this.selectedIds.length?this.dataService.actionBatch(this.selectedIds,"block").subscribe(n=>{this.clearSelected(),this.getList()},n=>this.showAlert(n.error||this.getLangString("ERROR"))):this.showAlert(this.getLangString("NOTHING_IS_SELECTED"))}deleteSelected(){0!==this.selectedIds.length?this.confirmAction(this.getLangString("YOU_SURE_YOU_WANT_DELETE_SELECTED")).then(n=>{"accept"===n&&this.dataService.actionBatch(this.selectedIds,"delete").subscribe(s=>{this.clearSelected(),this.getList()},s=>this.showAlert(s.error||this.getLangString("ERROR")))}):this.showAlert(this.getLangString("NOTHING_IS_SELECTED"))}showAlert(n){this.modalRef=this.modalService.open(C.$N),this.modalRef.componentInstance.modalContent=n,this.modalRef.componentInstance.modalTitle=this.getLangString("ERROR"),this.modalRef.componentInstance.messageType="error"}deleteItem(n){this.confirmAction(this.getLangString("YOU_SURE_YOU_WANT_DELETE")).then(s=>{"accept"===s&&this.dataService.deleteItem(n).subscribe(r=>{this.getList()},r=>{r.error&&this.showAlert(r.error)})})}clearSelected(){this.table&&this.table.clearSelected()}actionRequest(n){switch(n[0]){case"edit":this.modalOpen(n[1]);break;case"copy":this.modalOpen(n[1],!0);break;case"delete":this.deleteItem(n[1]);break;case"changeQuery":this.getList()}}getList(){this.loading=!0,this.dataService.getListPage(this.queryOptions).pipe((0,E.R)(this.destroyed$)).subscribe({next:n=>{this.items=n.items,this.collectionSize=n.total,this.loading=!1},error:n=>{this.items=[],this.collectionSize=0,n.error&&this.showAlert(n.error),this.loading=!1}})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}}return t.title="",t.\u0275fac=function(n){return new(n||t)(h.Y36(p.D),h.Y36(A.Kz),h.Y36(A.FF),h.Y36(v.sK))},t.\u0275dir=h.lG2({type:t,viewQuery:function(n,s){if(1&n&&h.Gf(q,7),2&n){let r;h.iGM(r=h.CRH())&&(s.table=r.first)}}}),t})()},843:(R,M,c)=>{c.d(M,{e:()=>T});class T{constructor(f,p,C,h,A){this.changed=f,this.loading=p,this.values=C,this.defaultOptions=h,this.defaultValues=A}}},1562:(R,M,c)=>{c.d(M,{g:()=>A});var T=c(4522),E=c(2411),f=c(2047),C=(c(843),c(6721)),h=c(3668);let A=(()=>{class v{constructor(_){this.http=_,this.headers=new T.WM({"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}),this.requestUrl="",this.baseUrl="",this.requestUrl="/admin/settings",this.baseUrl=C.d.getBaseUrl()}setRequestUrl(_){this.requestUrl=_}getRequestUrl(){return this.requestUrl}getList(){return this.http.get(this.getRequestUrl()).pipe((0,f.K)(this.handleError()))}clearSystemCache(){const _=this.getRequestUrl()+"/clear_system_cache";return this.http.post(_,{},{headers:this.headers}).pipe((0,f.K)(this.handleError()))}runActionPost(_){const t=this.getRequestUrl()+`/${_}`;return this.http.post(t,{},{headers:this.headers}).pipe((0,f.K)(this.handleError()))}updateGroup(_,t){const Z=this.getRequestUrl()+`/${_}`;return this.http.put(Z,t,{headers:this.headers}).pipe((0,f.K)(this.handleError()))}getComposerPackagesList(){return this.http.get(this.getRequestUrl()+"_composer_installed_packages").pipe((0,f.K)(this.handleError()))}composerRequirePackage(_,t){const Z=this.getRequestUrl()+"_composer_require_package";return this.http.post(Z,{packageName:_,packageVersion:t},{headers:this.headers}).pipe((0,f.K)(this.handleError()))}postFormData(_,t){const Z=new T.WM({enctype:"multipart/form-data",Accept:"application/json","X-Requested-With":"XMLHttpRequest"});return this.http.post(this.baseUrl+t,_,{headers:Z}).pipe((0,f.K)(this.handleError()))}runAction(_){return this.http.post(this.baseUrl+_,{},{headers:this.headers}).pipe((0,f.K)(this.handleError()))}handleError(_="operation",t){return Z=>{if(!(Z.status&&[401,403].indexOf(Z.status)>-1)){if(Z.error)throw Z.error;return(0,E.of)(t)}window.location.href=this.baseUrl+"/login"}}}return v.\u0275fac=function(_){return new(_||v)(h.LFG(T.eN))},v.\u0275prov=h.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()}}]);